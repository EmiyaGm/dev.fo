

<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <title>
    mongoDB 富查询 — FIBOS 开发者社区</title>
  <meta charset="utf-8">
  <meta name="description" content="FIBOS 是一个结合 FIBJS 以及 EOS 的 JavaScript 的运行平台">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">


  <meta property="og:type" content="article">
  <meta property="og:title" content="mongoDB 富查询 — Dev.fo">
  <meta property="og:description" content="FIBOS 是一个结合 FIBJS 以及 EOS 的 JavaScript 的运行平台">
  <meta property="og:image" content="https://dev.fo//images/downlogo.png">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="mongoDB 富查询 — Dev.fo">
  <meta name="twitter:description" content="FIBOS 是一个结合 FIBJS 以及 EOS 的 JavaScript 的运行平台">
  <meta name="twitter:image" content="https://dev.fo/images/downlogo.png">

  <link rel="apple-touch-icon" sizes="32x32" href="/images/icon/32*32.ico">
  <link rel="apple-touch-icon" sizes="64x64" href="/images/icon/64*64.ico">
  <link rel="icon" type="image/x-icon" sizes="32x32" href="/images/icon/32*32.ico">
  <link rel="icon" type="image/x-icon" sizes="64x64" href="/images/icon/64*64.ico">


  <meta name="msapplication-TileColor" content="#4fc08d">
  <meta name="theme-color" content="#4fc08d">

  <meta name="msapplication-config" content="browserconfig.xml">
  <link rel="manifest" href="/manifest.json">

  <!-- main page styles -->
  <link rel="stylesheet" href="/css/page.css">

  <script>
    window.PAGE_TYPE = "tutorials"
  </script>
</head>

<body class="docs">
  <div id="mobile-bar" >
    <a class="menu-button"></a>
    <a class="logo" href="/"></a>
  </div>
  <div id="header">
  <a id="logo" href="/">
    <img src="/images/Group.svg" alt="Developer logo">
    <!-- <span>Developer</span> -->
  </a>
  <ul id="nav">
    <!-- <li>
  <form id="search-form">
    <input type="text" id="search-query-nav" class="search-query st-default-search-input">
  </form>
</li> -->
<li>
  <a href="/" class="nav-link contribute">首页</a>
</li>
<li class="nav-dropdown-container learn">
  <a class="nav-link current">开发指南</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li><ul>
      <li><a href="/guide/introduction/introduction.html" class="nav-link">简介</a></li>
      <li><a href="/guide/installation/installation.html" class="nav-link">安装</a></li>
      <li><a href="/guide/start/start.html" class="nav-link">入门</a></li>
      <li><a href="/guide/tutorials/instructions.html" class="nav-link tutorials">教程</a></li>
      <li><a href="/guide/node/abouttestnet.html" class="nav-link current">节点编程</a></li>
      <li><a href="/guide/fibos.js/situation.html" class="nav-link">Fibos.js</a></li>
      <li><a href="/guide/contract/whatisabi.html" class="nav-link">智能合约</a></li>
      <li><a href="/guide/economic/eos2fibos.html" class="nav-link">Token 合约</a></li>
    </ul></li>
  </ul>
</li>

<li class="nav-dropdown-container learn">
    <a class="nav-link">技术手册</a><span class="arrow"></span>
    <ul class="nav-dropdown">
      <li><ul>
        <li><a href="/api/smartcontract/index.html" class="nav-link">JS 合约 API</a></li>
        <li><a href="http://www.fibjs.org/docs/manual/module/readme.md.html" target="_blank">FIBJS API</a></li>
      </ul></li>
    </ul>
  </li>
<!-- <li>
  <a href="/api/technology/index.html" class="nav-link team">技术手册</a>
</li> -->
<li>
  <a href="http://forum.fo/" class="nav-link contribute " target="_blank">社区</a>
</li>
<li>
  <a href="https://fibos.io/" class="nav-link contribute" target="_blank">FIBOS</a>
</li>
<!-- <li class="nav-dropdown-container language">
  <a class="nav-link">中文</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li><a href="https://vuejs.org/guide/node/fibosmongodb.html" class="nav-link" target="_blank">English</a></li>
    <li><a href="https://jp.vuejs.org/guide/node/fibosmongodb.html" class="nav-link" target="_blank">日本語</a></li>
    <li><a href="https://ru.vuejs.org/guide/node/fibosmongodb.html" class="nav-link" target="_blank">Русский</a></li>
    <li><a href="https://kr.vuejs.org/guide/node/fibosmongodb.html" class="nav-link" target="_blank">한국어</a></li>
    <li><a href="https://br.vuejs.org/guide/node/fibosmongodb.html" class="nav-link" target="_blank">Português</a></li>
    <li><a href="https://fr.vuejs.org/guide/node/fibosmongodb.html" class="nav-link" target="_blank">Français</a></li>
    <li><a href="https://vi.vuejs.org/guide/node/fibosmongodb.html" class="nav-link" target="_blank">Tiếng Việt</a></li>
  </ul>
</li>
 -->
  </ul>
</div>

  
  <div id="main" class="fix-sidebar">
    
    
  <div class="sidebar">
  <div class="sidebar-inner">
    <ul class="main-menu">
      <!-- <li>
  <form id="search-form">
    <input type="text" id="search-query-sidebar" class="search-query st-default-search-input">
  </form>
</li> -->
<li>
  <a href="/" class="nav-link contribute">首页</a>
</li>
<li class="nav-dropdown-container learn">
  <a class="nav-link current">开发指南</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li><ul>
      <li><a href="/guide/introduction/introduction.html" class="nav-link">简介</a></li>
      <li><a href="/guide/installation/installation.html" class="nav-link">安装</a></li>
      <li><a href="/guide/start/start.html" class="nav-link">入门</a></li>
      <li><a href="/guide/tutorials/instructions.html" class="nav-link tutorials">教程</a></li>
      <li><a href="/guide/node/abouttestnet.html" class="nav-link current">节点编程</a></li>
      <li><a href="/guide/fibos.js/situation.html" class="nav-link">Fibos.js</a></li>
      <li><a href="/guide/contract/whatisabi.html" class="nav-link">智能合约</a></li>
      <li><a href="/guide/economic/eos2fibos.html" class="nav-link">Token 合约</a></li>
    </ul></li>
  </ul>
</li>

<li class="nav-dropdown-container learn">
    <a class="nav-link">技术手册</a><span class="arrow"></span>
    <ul class="nav-dropdown">
      <li><ul>
        <li><a href="/api/smartcontract/index.html" class="nav-link">JS 合约 API</a></li>
        <li><a href="http://www.fibjs.org/docs/manual/module/readme.md.html" target="_blank">FIBJS API</a></li>
      </ul></li>
    </ul>
  </li>
<!-- <li>
  <a href="/api/technology/index.html" class="nav-link team">技术手册</a>
</li> -->
<li>
  <a href="http://forum.fo/" class="nav-link contribute " target="_blank">社区</a>
</li>
<li>
  <a href="https://fibos.io/" class="nav-link contribute" target="_blank">FIBOS</a>
</li>
<!-- <li class="nav-dropdown-container language">
  <a class="nav-link">中文</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li><a href="https://vuejs.org/guide/node/fibosmongodb.html" class="nav-link" target="_blank">English</a></li>
    <li><a href="https://jp.vuejs.org/guide/node/fibosmongodb.html" class="nav-link" target="_blank">日本語</a></li>
    <li><a href="https://ru.vuejs.org/guide/node/fibosmongodb.html" class="nav-link" target="_blank">Русский</a></li>
    <li><a href="https://kr.vuejs.org/guide/node/fibosmongodb.html" class="nav-link" target="_blank">한국어</a></li>
    <li><a href="https://br.vuejs.org/guide/node/fibosmongodb.html" class="nav-link" target="_blank">Português</a></li>
    <li><a href="https://fr.vuejs.org/guide/node/fibosmongodb.html" class="nav-link" target="_blank">Français</a></li>
    <li><a href="https://vi.vuejs.org/guide/node/fibosmongodb.html" class="nav-link" target="_blank">Tiếng Việt</a></li>
  </ul>
</li>
 -->
    </ul>
    <div class="list">
      
        <h2>
            
            开发指南
          </h2>
        <ul class="menu-root">
  
    
    
      
      
      
      
      
    
    
    <li>
      <a href="/guide/introduction/introduction.html" class="sidebar-link">介绍</a>
    </li>
  
    
    
      
      
      
      
      
    
    
    <li>
      <a href="/guide/installation/installation.html" class="sidebar-link">安装</a>
    </li>
  
    
    
      
      
      
      
      
    
    
    <li>
      <a href="/guide/start/start.html" class="sidebar-link">快速入门</a>
    </li>
  
    
    
      
        <li><h3>教程</h3></li>
      
      
      
      
      
    
    
    <li>
      <a href="/guide/tutorials/instructions.html" class="sidebar-link">简介</a>
    </li>
  
    
    
      
      
      
      
      
    
    
    <li>
      <a href="/guide/tutorials/setnode.html" class="sidebar-link">搭建本地测试节点</a>
    </li>
  
    
    
      
      
      
      
      
    
    
    <li>
      <a href="/guide/tutorials/abi.html" class="sidebar-link">智能合约——ABI 文件</a>
    </li>
  
    
    
      
      
      
      
      
    
    
    <li>
      <a href="/guide/tutorials/js.html" class="sidebar-link">智能合约——JS 合约</a>
    </li>
  
    
    
      
      
      
      
      
    
    
    <li>
      <a href="/guide/tutorials/deploy.html" class="sidebar-link">部署合约</a>
    </li>
  
    
    
      
      
      
      
      
    
    
    <li>
      <a href="/guide/tutorials/testcase.html" class="sidebar-link">测试合约</a>
    </li>
  
    
    
      
      
      
      
      
    
    
    <li>
      <a href="/guide/tutorials/usecontract.html" class="sidebar-link">开发 DApp 客户端</a>
    </li>
  
    
    
      
      
        <li><h3>节点编程</h3></li>
      
      
      
      
    
    
    <li>
      <a href="/guide/node/abouttestnet.html" class="sidebar-link">TestNet 介绍</a>
    </li>
  
    
    
      
      
      
      
      
    
    
    <li>
      <a href="/guide/node/jointestnet.html" class="sidebar-link">加入到 TestNet 网络</a>
    </li>
  
    
    
      
      
      
      
      
    
    
    <li>
      <a href="/guide/node/bp.html" class="sidebar-link">rpc 及 p2p 列表(持续更新)</a>
    </li>
  
    
    
      
      
      
      
      
    
    
    <li>
      <a href="/guide/node/howtobeproducerinfibos.html" class="sidebar-link">成为主网 bp 节点</a>
    </li>
  
    
    
      
      
      
      
      
    
    
    <li>
      <a href="/guide/node/fibosmongodb.html" class="sidebar-link current">mongoDB 富查询</a>
    </li>
  
    
    
      
      
      
      
      
    
    
    <li>
      <a href="/guide/node/emitter.html" class="sidebar-link">Emitter 插件使用</a>
    </li>
  
    
    
      
      
      
        <li><h3>Fibos.js</h3></li>
      
      
      
    
    
    <li>
      <a href="/guide/fibos.js/situation.html" class="sidebar-link">Fibos.js 介绍</a>
    </li>
  
    
    
      
      
      
      
      
    
    
    <li>
      <a href="/guide/fibos.js/createaccountnotfree.html" class="sidebar-link">在 FIBOS 中创建账号</a>
    </li>
  
    
    
      
      
      
      
      
    
    
    <li>
      <a href="/guide/fibos.js/getinfosync.html" class="sidebar-link">获取 FIBOS 相关信息</a>
    </li>
  
    
    
      
      
      
      
      
    
    
    <li>
      <a href="/guide/fibos.js/getaccountsync.html" class="sidebar-link">获取指定账号信息</a>
    </li>
  
    
    
      
      
      
      
      
    
    
    <li>
      <a href="/guide/fibos.js/getblocksync.html" class="sidebar-link">获取指定区块信息</a>
    </li>
  
    
    
      
      
      
      
      
    
    
    <li>
      <a href="/guide/fibos.js/getproducerssync.html" class="sidebar-link">获取当前节点列表信息</a>
    </li>
  
    
    
      
      
      
      
        <li><h3>智能合约</h3></li>
      
      
    
    
    <li>
      <a href="/guide/contract/whatisabi.html" class="sidebar-link">编写 ABI 接口</a>
    </li>
  
    
    
      
      
      
      
      
    
    
    <li>
      <a href="/guide/contract/crudoperations.html" class="sidebar-link">模块 DB 中的 crud 操作</a>
    </li>
  
    
    
      
      
      
      
      
    
    
    <li>
      <a href="/guide/contract/fibosauth.html" class="sidebar-link">FIBOS 权限系统</a>
    </li>
  
    
    
      
      
      
      
      
    
    
    <li>
      <a href="/guide/contract/inlinecall.html" class="sidebar-link">合约之间的相互调用</a>
    </li>
  
    
    
      
      
      
      
      
    
    
    <li>
      <a href="/guide/contract/recipientclass.html" class="sidebar-link">FIBOS 中的 recipient</a>
    </li>
  
    
    
      
      
      
      
      
        <li><h3>Token 合约</h3></li>
      
    
    
    <li>
      <a href="/guide/economic/eos2fibos.html" class="sidebar-link">从 EOS 跨链转账到 FIBOS</a>
    </li>
  
    
    
      
      
      
      
      
    
    
    <li>
      <a href="/guide/economic/fibos2eos.html" class="sidebar-link">从 FIBOS 跨链转账到 EOS</a>
    </li>
  
    
    
      
      
      
      
      
    
    
    <li>
      <a href="/guide/economic/eos2fo.html" class="sidebar-link">EOS 与 FO 通证相互兑换</a>
    </li>
  
    
    
      
      
      
      
      
    
    
    <li>
      <a href="/guide/economic/howtoexchangetokeninfibos.html" class="sidebar-link">智能通证互兑</a>
    </li>
  
    
    
      
      
      
      
      
    
    
    <li>
      <a href="/guide/economic/howtocreatetokeninfibos.html" class="sidebar-link">发行和销毁通证</a>
    </li>
  
    
    
      
      
      
      
      
    
    
    <li>
      <a href="/guide/economic/howtouselock.html" class="sidebar-link">锁仓和解锁功能</a>
    </li>
  
    
    
      
      
      
      
      
    
    
    <li>
      <a href="/guide/economic/howtousecontractaccount.html" class="sidebar-link">合约子钱包</a>
    </li>
  
</ul>

      
    </div>
  </div>
</div>


<div class="content tutorials with-sidebar ">
  
    
  
  
    <h1>mongoDB 富查询</h1>
  
  
    <p>在业务中我们经常会有查询历史数据的场景，比如：某个账户的历史转账记录，但是考虑到性能的问题，在 EOS 中使用自身查询历史数据并不是个很好的方案，另外 EOS 的 history API 模块部分功能迭代快，甚至即将废弃。</p>
<p>EOS 本身提供了mongoDB 的插件（eosio::mongo_db_plugin），FIBOS 也沿用了这个特性。该模块实现原理是将区块的数据同步至 mongoDB。这使得此方式让 mongoDB 成为了中心化数据存储，畅想一下一个 FIBOS 的浏览器，在设计上我们可以让 FIBOS 节点服务和基于 mongoDB 的查询业务分离，让性能大大的提高。</p>
<p>阅读完本篇文章，你可以学会如何利用 FIBOS 内置的 mongo_db 模块将数据同步至 mongoDB，并使用 mongoDB 查询 FIBOS 的区块数据。</p>
<p>赶紧安装新版 FIBOS 试试吧！<a href="../installation/installation.html">安装运行环境</a></p>
<ul>
<li><p>本文测试环境：</p>
<p>系统：macOS</p>
</li>
<li><p>本章涉及到的文件列表：</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">hello_mongoDB/</span><br><span class="line">├── local</span><br><span class="line">│   ├── client.js</span><br><span class="line">│   └── node.js</span><br><span class="line">└── testnet</span><br><span class="line">    ├── client.js</span><br><span class="line">    └── node.js</span><br></pre></td></tr></table></figure>
</li>
<li><p>本章节示例代码地址：<a href="https://github.com/FIBOSIO/samples" target="_blank" rel="noopener">https://github.com/FIBOSIO/samples</a></p>
</li>
</ul>
<h2 id="本地快速体验"><a href="#本地快速体验" class="headerlink" title="本地快速体验"></a>本地快速体验</h2><p>我们在本地启动一个 FIBOS 节点服务，创建账户并在 mongoDB 中进行查询。</p>
<h4 id="启动-mongod-服务"><a href="#启动-mongod-服务" class="headerlink" title="启动 mongod 服务"></a>启动 mongod 服务</h4><p>如果你还未安装 mongoDB，请参考 <a href="https://docs.mongoDB.com/manual/administration/install-community/" target="_blank" rel="noopener">Install mongoDB Community Edition</a>。</p>
<p>首先我们需要启动 mongod 服务，命令如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fibos$ mongod</span><br></pre></td></tr></table></figure>
<p>可以看到如下输出，说明 mongod 服务成功启动：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">2018-08-08T09:52:09.459+0800 I CONTROL  [main] Automatically disabling TLS 1.0, to force-enable TLS 1.0 specify --sslDisabledProtocols &apos;none&apos;</span><br><span class="line">2018-08-08T09:52:09.534+0800 I CONTROL  [initandlisten] mongoDB starting : pid=8061 port=27017 dbpath=/data/db 64-bit host=Velen</span><br><span class="line">2018-08-08T09:52:09.534+0800 I CONTROL  [initandlisten] db version v4.0.1</span><br><span class="line">2018-08-08T09:52:09.534+0800 I CONTROL  [initandlisten] git version: 54f1582fc6eb01de4d4c42f26fc133e623f065fb</span><br><span class="line">2018-08-08T09:52:09.534+0800 I CONTROL  [initandlisten] allocator: system</span><br><span class="line">2018-08-08T09:52:09.534+0800 I CONTROL  [initandlisten] modules: none</span><br><span class="line">2018-08-08T09:52:09.534+0800 I CONTROL  [initandlisten] build environment:</span><br><span class="line">2018-08-08T09:52:09.534+0800 I CONTROL  [initandlisten]     distarch: x86_64</span><br><span class="line">2018-08-08T09:52:09.534+0800 I CONTROL  [initandlisten]     target_arch: x86_64</span><br></pre></td></tr></table></figure>
<h4 id="启动-FIBOS-环境"><a href="#启动-FIBOS-环境" class="headerlink" title="启动 FIBOS 环境"></a>启动 FIBOS 环境</h4><p>如果你还未安装 FIBOS，请参考 <a href="../installation/installation.html">安装运行环境</a>。</p>
<p>想要将数据同步至 mongoDB ，仅需在入门教程中的代码加入一段 <code>fibos.load(&#39;mongo_db&#39;)</code> ，将 mongo_db 这个模块载入 FIBOS。只需要三行代码，FIBOS 便会将区块数据自动同步至 mongoDB，非常方便。</p>
<p>端口号和数据库名称可以自行更改，在本教程中端口为 27017，数据库名为 eosmain。 以下代码保存至 <code>./local/node.js</code>。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fibos = <span class="built_in">require</span>(<span class="string">'fibos'</span>);</span><br><span class="line"></span><br><span class="line">fibos.load(<span class="string">'http'</span>,&#123;</span><br><span class="line">    <span class="string">'http-server-address'</span>: <span class="string">'0.0.0.0:8888'</span></span><br><span class="line">&#125;);</span><br><span class="line">fibos.load(<span class="string">'chain'</span>, &#123;</span><br><span class="line">    <span class="string">'contracts-console'</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">'delete-all-blocks'</span>: <span class="literal">true</span>,</span><br><span class="line">&#125;);</span><br><span class="line">fibos.load(<span class="string">'net'</span>);</span><br><span class="line">fibos.load(<span class="string">'chain_api'</span>);</span><br><span class="line">fibos.load(<span class="string">'history_api'</span>);</span><br><span class="line">fibos.load(<span class="string">'producer'</span>, &#123;</span><br><span class="line">    <span class="string">'producer-name'</span>: <span class="string">'eosio'</span>,</span><br><span class="line">    <span class="string">'enable-stale-production'</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">'max-transaction-time'</span>: <span class="number">3000</span></span><br><span class="line">&#125;);</span><br><span class="line">fibos.load(<span class="string">'mongo_db'</span>, &#123;</span><br><span class="line">    <span class="string">'mongodb-uri'</span>: <span class="string">'mongodb://localhost:27017/eosmain'</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">fibos.start();</span><br></pre></td></tr></table></figure>
<p>启动 FIBOS 环境：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fibos$ fibos ./local/node.js</span><br></pre></td></tr></table></figure>
<p>在启动后，我们在 mongd 的日志中会看到如下输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">2018-08-08T11:33:42.867+0800 I NETWORK  [listener] connection accepted from 127.0.0.1:54259 #2 (2 connections now open)</span><br><span class="line">2018-08-08T11:33:42.868+0800 I NETWORK  [conn2] received client metadata from 127.0.0.1:54259 conn2: &#123; driver: &#123; name: &apos;mongoc / mongocxx&apos;, version: &apos;1.10.2 / 3.3.1-pre&apos; &#125;, os: &#123; type: &apos;Darwin&apos;, name: &apos;macOS&apos;, version: &apos;18.0.0&apos;, architecture: &apos;x86_64&apos; &#125;, platform: &apos;cfg=0x00d6a265 posix=200112 stdc=201112 CC=clang 9.1.0 (clang-902.0.39.2) CFLAGS=&apos;&apos; LDFLAGS=&apos;&apos;&apos; &#125;</span><br><span class="line">2018-08-08T11:33:42.873+0800 I STORAGE  [conn2] createCollection: eosmain.accounts with generated UUID: 0e553ab1-4c07-436a-abf7-62c6864779ed</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">2018-08-08T11:33:43.925+0800 I COMMAND  [conn2] command eosmain.$cmd command: createIndexes &#123; createIndexes: &apos;actions&apos;, indexes: [ &#123; name: &apos;trx_id_1&apos;, key: &#123; trx_id: 1 &#125; &#125; ], $db: &apos;eosmain&apos;, lsid: &#123; id: UUID(&apos;1ee67ce9-d0db-4ad1-9737-c4fba7f850ca&apos;) &#125; &#125; numYields:0 reslen:114 locks:&#123; Global: &#123; acquireCount: &#123; r: 1, w: 1 &#125; &#125;, Database: &#123; acquireCount: &#123; W: 1 &#125; &#125;, Collection: &#123; acquireCount: &#123; w: 1 &#125; &#125; &#125; protocol:op_msg 119ms</span><br><span class="line">2018-08-08T11:33:44.019+0800 I STORAGE  [conn2] createCollection: eosmain.transaction_traces with generated UUID: a637e777-aed4-45d2-9bf6-b149bc4e702b</span><br></pre></td></tr></table></figure>
<p>通过日志可以查看到 FIBOS 为我们做了如下事情：</p>
<ol>
<li>创建集合：accounts，actions，block_states，blocks，transaction_traces，transactions</li>
<li>给各集合创建必要的索引</li>
</ol>
<p>我们进入 mongoDB 的客户端 mongo 进行查询，会看到 eosmain 数据库被成功创建：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; show dbs</span><br><span class="line">admin          0.000GB</span><br><span class="line">config         0.000GB</span><br><span class="line">eosmain        0.002GB</span><br><span class="line">local          0.000GB</span><br></pre></td></tr></table></figure>
<p>进入 eosmain 数据库，会发现 FIBOS 在 mongoDB 中创建了 5 个集合：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt; use eosmain</span><br><span class="line">switched to db eosmain</span><br><span class="line">&gt; show tables</span><br><span class="line">accounts</span><br><span class="line">actions</span><br><span class="line">block_states</span><br><span class="line">blocks</span><br><span class="line">transaction_traces</span><br><span class="line">transactions</span><br></pre></td></tr></table></figure>
<p>我们可以直接查询 accounts 集合中的数据：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.accounts.find()</span><br><span class="line">&#123; &apos;_id&apos; : ObjectId(&apos;5b6a6496bc9b452f1e4750d2&apos;), &apos;name&apos; : &apos;eosio&apos;, &apos;createdAt&apos; : ISODate(&apos;2018-08-08T03:33:42.869Z&apos;) &#125;</span><br></pre></td></tr></table></figure>
<p>会发现已有一个系统账户 eosio 的数据被同步到了 mongoDB。</p>
<h4 id="新建账户，在-mongoDB-中查询数据"><a href="#新建账户，在-mongoDB-中查询数据" class="headerlink" title="新建账户，在 mongoDB 中查询数据"></a>新建账户，在 mongoDB 中查询数据</h4><p>接着，我们使用脚本创建一个新账户并在 mongoDB 查询。以下代码保存至 <code>./local/client.js</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> FIBOS = <span class="built_in">require</span>(<span class="string">'fibos.js'</span>);</span><br><span class="line"><span class="keyword">var</span> config = &#123;</span><br><span class="line">    <span class="string">'chainId'</span>: <span class="string">'cf057bbfb72640471fd910bcb67639c22df9f92470936cddc1ade0e2f2e7dc4f'</span>,</span><br><span class="line">    <span class="string">'producer-name'</span>: <span class="string">'eosio'</span>,</span><br><span class="line">    <span class="string">'public-key'</span>: <span class="string">'FO6MRyAjQq8ud7hVNYcfnVPJqcVpscN5So8BhtHuGYqET5GDW5CV'</span>,</span><br><span class="line">    <span class="string">'private-key'</span>: <span class="string">'5KQwrPbwdL6PhXujxW37FSSQZ1JiwsST4cqQzDeyXtP79zkvFD3'</span>,</span><br><span class="line">    <span class="string">'httpEndpoint'</span>: <span class="string">'http://127.0.0.1:8888'</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> fibos = FIBOS(&#123;</span><br><span class="line">    chainId: config[<span class="string">'chainId'</span>],</span><br><span class="line">    keyProvider: config[<span class="string">'private-key'</span>],</span><br><span class="line">    httpEndpoint: config[<span class="string">'httpEndpoint'</span>],</span><br><span class="line">    logger: &#123;</span><br><span class="line">        log: <span class="literal">null</span>,</span><br><span class="line">        error: <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> result = fibos.newaccountSync(&#123;</span><br><span class="line">    creator: <span class="string">'eosio'</span>,</span><br><span class="line">    name: <span class="string">'hellomongodb'</span>,</span><br><span class="line">    owner: config[<span class="string">'public-key'</span>],</span><br><span class="line">    active: config[<span class="string">'public-key'</span>]</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'result: '</span>, result);</span><br></pre></td></tr></table></figure>
<p>执行脚本:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fibos$ fibos ./local/client.js</span><br></pre></td></tr></table></figure>
<p>脚本结果（片段）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">result:  &#123;</span><br><span class="line">  &apos;broadcast&apos;: true,</span><br><span class="line">  &apos;transaction&apos;: &#123;</span><br><span class="line">    &apos;compression&apos;: &apos;none&apos;,</span><br><span class="line">    &apos;transaction&apos;: &#123;</span><br><span class="line">      &apos;expiration&apos;: &apos;2018-08-08T03:49:44&apos;,</span><br><span class="line">      &apos;ref_block_num&apos;: 10,</span><br><span class="line">      &apos;ref_block_prefix&apos;: 241484686,</span><br><span class="line">      &apos;net_usage_words&apos;: 0,</span><br><span class="line">      &apos;max_cpu_usage_ms&apos;: 0,</span><br><span class="line">      &apos;delay_sec&apos;: 0,</span><br><span class="line">      &apos;context_free_actions&apos;: [],</span><br><span class="line">      &apos;actions&apos;: [</span><br><span class="line">        &#123;</span><br><span class="line">          &apos;account&apos;: &apos;eosio&apos;,</span><br><span class="line">          &apos;name&apos;: &apos;newaccount&apos;,</span><br><span class="line">          &apos;authorization&apos;: [</span><br><span class="line">            &#123;</span><br><span class="line">              &apos;actor&apos;: &apos;eosio&apos;,</span><br><span class="line">              &apos;permission&apos;: &apos;active&apos;</span><br><span class="line">            &#125;</span><br><span class="line">          ],</span><br><span class="line">          &apos;data&apos;: &apos;0000000000ea3055701265934a1aa36a01000000010002c0ded2bc1f1305fb0faac5e6c03ee3a1924234985427b6167ca569d13df435cf0100000001000000010002c0ded2bc1f1305fb0faac5e6c03ee3a1924234985427b6167ca569d13df435cf01000000&apos;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>经过短暂的同步后，我们在 mongo 中查询账户数据：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.accounts.find()</span><br><span class="line">&#123; &apos;_id&apos; : ObjectId(&apos;5b6a6496bc9b452f1e4750d2&apos;), &apos;name&apos; : &apos;eosio&apos;, &apos;createdAt&apos; : ISODate(&apos;2018-08-08T03:33:42.869Z&apos;) &#125;</span><br><span class="line">&#123; &apos;_id&apos; : ObjectId(&apos;5b6a681cbc9b453001230003&apos;), &apos;name&apos; : &apos;hellomongodb&apos;, &apos;createdAt&apos; : ISODate(&apos;2018-08-08T03:48:44.863Z&apos;) &#125;</span><br></pre></td></tr></table></figure>
<p>会发现账户数据多了一条刚才创建的 hellomongodb 数据。进行到这步，恭喜你，你已经学会了如何将 FIBOS 网络中的区块数据同步至 mongoDB 并使用 mongo 客户端进行查询！</p>
<p>下面，我们将启动一个新的节点同步 TestNet 网络，并将其数据同步至 mongoDB，并利用 mongoDB 的语法查询我们发起的交易。</p>
<h2 id="进阶，利用-mongoDB-查询-TestNet-数据"><a href="#进阶，利用-mongoDB-查询-TestNet-数据" class="headerlink" title="进阶，利用 mongoDB 查询 TestNet 数据"></a>进阶，利用 mongoDB 查询 TestNet 数据</h2><p>如果你对加入 TestNet 网络的步骤还不熟悉，请参考 <a href="abouttestnet.html">加入到 TestNet 网络</a>。</p>
<h4 id="启动-FIBOS-环境，加入-TestNet-网络"><a href="#启动-FIBOS-环境，加入-TestNet-网络" class="headerlink" title="启动 FIBOS 环境，加入 TestNet 网络"></a>启动 FIBOS 环境，加入 TestNet 网络</h4><p>首先，我们使用 ctrl + c 关闭之前的本地私有链节点，并执行 <code>db.dropDatabase()</code> 将之前的 <code>eosmanin</code> 数据库删除。然后，我们启动一个新的节点加入 TestNet 网络。以下代码保存至 <code>./testnet/node.js</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fibos = <span class="built_in">require</span>(<span class="string">'fibos'</span>);</span><br><span class="line"></span><br><span class="line">fibos.config_dir = <span class="string">'sync_data_Dir'</span>;</span><br><span class="line">fibos.data_dir = <span class="string">'sync_data_Dir'</span>;</span><br><span class="line"></span><br><span class="line">fibos.load(<span class="string">'http'</span>, &#123;</span><br><span class="line">    <span class="string">'http-server-address'</span>: <span class="string">'0.0.0.0:8888'</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">fibos.load(<span class="string">'net'</span>, &#123;</span><br><span class="line">    <span class="string">'p2p-listen-endpoint'</span>: <span class="string">'0.0.0.0:9876'</span>,</span><br><span class="line">    <span class="string">'p2p-peer-address'</span>: <span class="string">'103.80.170.107:9876'</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">fibos.load(<span class="string">'producer'</span>);</span><br><span class="line">fibos.load(<span class="string">'chain'</span>, &#123;</span><br><span class="line">    <span class="string">'delete-all-blocks'</span>: <span class="literal">true</span></span><br><span class="line">&#125;);</span><br><span class="line">fibos.load(<span class="string">'chain_api'</span>);</span><br><span class="line">fibos.load(<span class="string">'wallet'</span>);</span><br><span class="line">fibos.load(<span class="string">'wallet_api'</span>);</span><br><span class="line">fibos.load(<span class="string">'mongo_db'</span>, &#123;</span><br><span class="line">    <span class="string">'mongodb-uri'</span>: <span class="string">'mongodb://localhost:27017/eosmain'</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">fibos.start();</span><br></pre></td></tr></table></figure>
<p>执行脚本：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fibos$ fibos ./testnet/node.js</span><br></pre></td></tr></table></figure>
<p>输出结果（片段）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">2018-08-08T04:46:38.052 thread-0   http_plugin.cpp:344           plugin_initialize    ] configured http to listen on 0.0.0.0:8888</span><br><span class="line">2018-08-08T04:46:38.052 thread-0   chain_plugin.cpp:271          plugin_initialize    ] initializing chain plugin</span><br><span class="line">2018-08-08T04:46:38.053 thread-0   chain_plugin.cpp:408          plugin_initialize    ] Deleting state database and blocks</span><br><span class="line">2018-08-08T04:46:38.223 thread-0   chain_plugin.cpp:508          plugin_initialize    ] Starting up fresh blockchain with default genesis state.</span><br></pre></td></tr></table></figure>
<p>我们进入 mongo 中查询，会发现 TestNet 中的账户数据已有一部分同步到了 mongoDB 中：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; use eosmain</span><br><span class="line">&gt; db.accounts.find()</span><br></pre></td></tr></table></figure>
<h4 id="新建账户，在-mongoDB-中查询数据-1"><a href="#新建账户，在-mongoDB-中查询数据-1" class="headerlink" title="新建账户，在 mongoDB 中查询数据"></a>新建账户，在 mongoDB 中查询数据</h4><p>在本教程中，我们新建了一个名为 hellomongodb 的账户。</p>
<p>我们新建脚本用来查询刚刚注册的账户信息，以下代码保存至 <code>./testnet/client.js</code>（注意替换你自己生成的私钥以及账户名）：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> FIBOS = <span class="built_in">require</span>(<span class="string">'fibos.js'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> config = &#123;</span><br><span class="line">    chainId: <span class="string">'cf057bbfb72640471fd910bcb67639c22df9f92470936cddc1ade0e2f2e7dc4f'</span>, <span class="comment">// 32 byte (64 char) hex string</span></span><br><span class="line">    keyProvider: <span class="string">'// 填入注册时生成的私钥'</span>, <span class="comment">// WIF string or array of keys..</span></span><br><span class="line">    httpEndpoint: <span class="string">'http://103.80.170.107:8888'</span>,</span><br><span class="line">    logger: &#123;</span><br><span class="line">        log: <span class="literal">null</span>,</span><br><span class="line">        error: <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> fibos = FIBOS(config);</span><br><span class="line"><span class="keyword">var</span> balance = fibos.getTableRowsSync(<span class="literal">true</span>, <span class="string">'eosio.token'</span>, <span class="string">'hellomongoDB'</span>, <span class="string">'accounts'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'balance'</span>, balance);</span><br></pre></td></tr></table></figure>
<p>执行脚本：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fibos$ fibos client.js</span><br></pre></td></tr></table></figure>
<p>输出结果（片段）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">account:  &#123;</span><br><span class="line">  &apos;account_name&apos;: &apos;hellomongodb&apos;,</span><br><span class="line">  &apos;head_block_num&apos;: 14022,</span><br><span class="line">  &apos;head_block_time&apos;: &apos;2018-08-08T04:58:48.000&apos;,</span><br><span class="line">  &apos;privileged&apos;: false,</span><br><span class="line">  &apos;last_code_update&apos;: &apos;1970-01-01T00:00:00.000&apos;,</span><br><span class="line">  &apos;created&apos;: &apos;2018-08-08T04:51:23.500&apos;,</span><br><span class="line">  &apos;core_liquid_balance&apos;: &apos;50.0000 FO&apos;,</span><br><span class="line">  &apos;ram_quota&apos;: 4073,</span><br><span class="line">  &apos;net_weight&apos;: 500000,</span><br><span class="line">  &apos;cpu_weight&apos;: 500000,</span><br><span class="line">  &apos;net_limit&apos;: &#123;</span><br><span class="line">    &apos;used&apos;: 0,</span><br><span class="line">    &apos;available&apos;: 22649235,</span><br><span class="line">    &apos;max&apos;: 22649235</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>我们可以看到刚刚注册的账户 hellomongodb 的信息，以及系统赠送的 50 FO。经过一段时间的同步后，我们可以在 mongo 中查询到我们的账户数据：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.accounts.find(&#123;&apos;name&apos;:&apos;hellomongodb&apos;&#125;)</span><br><span class="line">&#123; &apos;_id&apos; : ObjectId(&apos;5b6a7863bc9b4532eb0add48&apos;), &apos;name&apos; : &apos;hellomongodb&apos;, &apos;createdAt&apos; : ISODate(&apos;2018-08-08T04:58:11.306Z&apos;) &#125;</span><br></pre></td></tr></table></figure>
<h4 id="发起交易，利用-mongoDB-查询交易数据"><a href="#发起交易，利用-mongoDB-查询交易数据" class="headerlink" title="发起交易，利用 mongoDB 查询交易数据"></a>发起交易，利用 mongoDB 查询交易数据</h4><p>mongoDB 的查询方法具体语法为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.collection.find(query, projection)</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>query</strong> ：可选，使用查询操作符指定查询条件</li>
<li><strong>projection</strong> ：可选，使用投影操作符指定返回的键。查询时返回文档中所有键值， 只需省略该参数即可（默认省略）。</li>
</ul>
<p>如果你需要以易读的方式来读取数据，可以使用 pretty() 方法，语法格式如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.col.find().pretty()</span><br></pre></td></tr></table></figure>
<p>pretty() 方法以格式化的方式来显示所有文档。</p>
<p>下面，我们来进行一笔转账，然后通过 trx_id 作为查询条件来查询这个交易的记录。</p>
<p>首先，我们使用刚刚创建的账户进行一笔转账交易。对 <code>./testnet/client.js</code> 代码作如下修改：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> FIBOS = <span class="built_in">require</span>(<span class="string">'fibos.js'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> config = &#123;</span><br><span class="line">    chainId: <span class="string">'cf057bbfb72640471fd910bcb67639c22df9f92470936cddc1ade0e2f2e7dc4f'</span>, <span class="comment">// 32 byte (64 char) hex string</span></span><br><span class="line">    keyProvider: <span class="string">'5KH6znunJQBdexEVcx7FkeJH7Npswi9hEpJx2fXqAvQA77SPE6V'</span>, <span class="comment">// WIF string or array of keys..</span></span><br><span class="line">    httpEndpoint: <span class="string">'http://103.80.170.107:8888'</span>,</span><br><span class="line">    logger: &#123;</span><br><span class="line">        log: <span class="literal">null</span>,</span><br><span class="line">        error: <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> fibos = FIBOS(config);</span><br><span class="line"><span class="keyword">var</span> ctx = fibos.contractSync(<span class="string">'eosio.token'</span>);</span><br><span class="line"><span class="keyword">var</span> result = ctx.transferSync(<span class="string">'hellomongodb'</span>, <span class="string">'eosio'</span>, <span class="string">'10.0000 FO'</span>, <span class="string">'transfer'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'result'</span>, result);</span><br></pre></td></tr></table></figure>
<p>执行脚本：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fibos$ fibos ./testnet/client.js</span><br></pre></td></tr></table></figure>
<p>输出结果（片段），包含交易的详细信息，如签名，from 账户名，to 账户名，交易 id 等：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">result &#123;</span><br><span class="line">  &apos;broadcast&apos;: true,</span><br><span class="line">  &apos;transaction&apos;: &#123;</span><br><span class="line">    &apos;compression&apos;: &apos;none&apos;,</span><br><span class="line">    &apos;transaction&apos;: &#123;</span><br><span class="line">      &apos;expiration&apos;: &apos;2018-08-08T06:34:34&apos;,</span><br><span class="line">      &apos;ref_block_num&apos;: 25363,</span><br><span class="line">      &apos;ref_block_prefix&apos;: 2317966385,</span><br><span class="line">      &apos;net_usage_words&apos;: 0,</span><br><span class="line">      &apos;max_cpu_usage_ms&apos;: 0,</span><br><span class="line">      &apos;delay_sec&apos;: 0,</span><br><span class="line">      &apos;context_free_actions&apos;: [],</span><br><span class="line">      &apos;actions&apos;: [</span><br><span class="line">        &#123;</span><br><span class="line">          &apos;account&apos;: &apos;eosio.token&apos;,</span><br><span class="line">          &apos;name&apos;: &apos;transfer&apos;,</span><br><span class="line">          &apos;authorization&apos;: [</span><br><span class="line">            &#123;</span><br><span class="line">              &apos;actor&apos;: &apos;hellomongodb&apos;,</span><br><span class="line">              &apos;permission&apos;: &apos;active&apos;</span><br><span class="line">            &#125;</span><br><span class="line">          ],</span><br><span class="line">          &apos;data&apos;: &apos;701265934a1aa36a0000000000ea3055a08601000000000004464f0000000000087472616e73666572&apos;</span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      &apos;transaction_extensions&apos;: []</span><br><span class="line">    &#125;,</span><br><span class="line">    &apos;signatures&apos;: [</span><br><span class="line">      &apos;SIG_K1_K9V3rSTcXBjfAdHiCmmrPbjrs5SjR4Qzjb1u12du9qD2pC8pwGfdrpt9p4t8YZxCGNRRrTgaFYV83kwNJnxUc1MtaghjBk&apos;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  &apos;transaction_id&apos;: &apos;2c35fb9fbaaa1164da7204eb51d8fcc6299408d30a79a3410368c8afa5d8932e&apos;,</span><br></pre></td></tr></table></figure>
<p>经过一段时间的同步后，我们使用刚才打印出的交易 id （即 transaction_id ）在 mongo 中进行查询：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.transactions.find(&#123;&apos;trx_id&apos;:&apos;2c35fb9fbaaa1164da7204eb51d8fcc6299408d30a79a3410368c8afa5d8932e&apos;&#125;).pretty()</span><br><span class="line">&#123;</span><br><span class="line">	&apos;_id&apos; : ObjectId(&apos;5b6a8fa5bc9b45370a38f234&apos;),</span><br><span class="line">	&apos;trx_id&apos; : &apos;2c35fb9fbaaa1164da7204eb51d8fcc6299408d30a79a3410368c8afa5d8932e&apos;,</span><br><span class="line">	&apos;irreversible&apos; : true,</span><br><span class="line">	&apos;transaction_header&apos; : &#123;</span><br><span class="line">		&apos;expiration&apos; : &apos;2018-08-08T06:34:34&apos;,</span><br><span class="line">		&apos;ref_block_num&apos; : 25363,</span><br><span class="line">		&apos;ref_block_prefix&apos; : NumberLong(&apos;2317966385&apos;),</span><br><span class="line">		&apos;max_net_usage_words&apos; : 0,</span><br><span class="line">		&apos;max_cpu_usage_ms&apos; : 0,</span><br><span class="line">		&apos;delay_sec&apos; : 0</span><br><span class="line">	&#125;,</span><br><span class="line">	&apos;signing_keys&apos; : &#123;</span><br><span class="line">		&apos;0&apos; : &apos;FO8R5TLhkDNDeV8XNWaSKeu2Q2knV4S2MJMbPcUz9vKfF84yrfdW&apos;</span><br><span class="line">	&#125;,</span><br><span class="line">	&apos;actions&apos; : [</span><br><span class="line">		&#123;</span><br><span class="line">			&apos;action_num&apos; : 0,</span><br><span class="line">			&apos;trx_id&apos; : &apos;2c35fb9fbaaa1164da7204eb51d8fcc6299408d30a79a3410368c8afa5d8932e&apos;,</span><br><span class="line">			&apos;cfa&apos; : false,</span><br><span class="line">			&apos;account&apos; : &apos;eosio.token&apos;,</span><br><span class="line">			&apos;name&apos; : &apos;transfer&apos;,</span><br><span class="line">			&apos;authorization&apos; : [</span><br><span class="line">				&#123;</span><br><span class="line">					&apos;actor&apos; : &apos;hellomongodb&apos;,</span><br><span class="line">					&apos;permission&apos; : &apos;active&apos;</span><br><span class="line">				&#125;</span><br><span class="line">			],</span><br><span class="line">			&apos;data&apos; : &#123;</span><br><span class="line">				&apos;from&apos; : &apos;hellomongodb&apos;,</span><br><span class="line">				&apos;to&apos; : &apos;eosio&apos;,</span><br><span class="line">				&apos;quantity&apos; : &apos;10.0000 FO&apos;,</span><br><span class="line">				&apos;memo&apos; : &apos;transfer&apos;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	],</span><br><span class="line">	&apos;transaction_extensions&apos; : &#123;</span><br><span class="line"></span><br><span class="line">	&#125;,</span><br><span class="line">	&apos;signatures&apos; : &#123;</span><br><span class="line">		&apos;0&apos; : &apos;SIG_K1_K9V3rSTcXBjfAdHiCmmrPbjrs5SjR4Qzjb1u12du9qD2pC8pwGfdrpt9p4t8YZxCGNRRrTgaFYV83kwNJnxUc1MtaghjBk&apos;</span><br><span class="line">	&#125;,</span><br><span class="line">	&apos;context_free_data&apos; : &#123;</span><br><span class="line"></span><br><span class="line">	&#125;,</span><br><span class="line">	&apos;createdAt&apos; : ISODate(&apos;2018-08-08T06:37:25.887Z&apos;),</span><br><span class="line">	&apos;block_id&apos; : &apos;0000632bec098cee125b2c4f5fe630424b04f1bae9b5ec2bec274697e44a5751&apos;,</span><br><span class="line">	&apos;block_num&apos; : 25387,</span><br><span class="line">	&apos;updatedAt&apos; : ISODate(&apos;2018-08-08T06:37:28.083Z&apos;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看到交易的详细数据都已经同步到了 mongoDB。</p>
<h4 id="分页加排序，mongoDB-显神威"><a href="#分页加排序，mongoDB-显神威" class="headerlink" title="分页加排序，mongoDB 显神威"></a>分页加排序，mongoDB 显神威</h4><p>对大多数业务，翻页和排序是基本功能。mongoDB 支持使用 sort 排序，limit 配合 skip 进行 分页。那么我们利用这一特性，来实现一个简单的功能：按创建时间倒序查询交易信息，并且能够以每页10条记录进行展现。</p>
<p>语句十分简单，在 mongo 客户端中输入：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.transactions.find().sort(&#123;&apos;createdAt&apos;: -1&#125;).skip(0).limit(5).pretty()</span><br></pre></td></tr></table></figure>
<p>即可看到有5条按创建时间倒序的交易数据被查出，下面进行翻页：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.transactions.find().sort(&#123;&apos;createdAt&apos;: -1&#125;).skip(5).limit(5).pretty()</span><br></pre></td></tr></table></figure>
<p>可以看到下一页的5条数据。利用这一特性，我们可以做一个简单区块链浏览器啦 ~</p>
<p>至此，你已经达成将 TestNet 网络的数据同步至 mongoDB 并进行查询这一小目标，加油，一起继续探索 FIBOS 吧~</p>

  
  
</div>

    
  </div>
  <script src="/js/smooth-scroll.min.js">"</script>
  

  <!-- main custom script for sidebars, version selects etc. -->
  <script src="/js/css.escape.js">"</script>
  <script src="/js/common.js">"</script>

  <!-- fastclick -->
  <script src="/js/fastclick.js">"</script>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      FastClick.attach(document.body)
    }, false)
  </script>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-125332104-3"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() {
      dataLayer.push(arguments);
    }
    gtag('js', new Date());
    gtag('config', 'UA-125332104-3');
  </script>
</body>

</html>